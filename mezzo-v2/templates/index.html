<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mezzo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='10' fill='orange'/><text x='50' y='70' font-family='Arial' font-size='60' text-anchor='middle' fill='white'>ü¶è</text></svg>">  
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: radial-gradient(circle at center, white, #a5a5a5);
            overflow: hidden; /* –£–±–∏—Ä–∞–µ–º –ø–æ–ª–æ—Å—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        }

        header {
            text-align: center;
            padding: 5px 0; /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É */
        }

        h1 {
            color: #333;
            background: linear-gradient(145deg, 
                #e0e0e0 0%, 
                #ffffff 20%, 
                #e0e0e0 40%, 
                #a0a0a0 60%, 
                #e0e0e0 80%, 
                #ffffff 100%);
            padding: 12px 30px;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.2),
                inset 0 1px 2px rgba(255,255,255,0.8),
                inset 0 -1px 2px rgba(0,0,0,0.1);
            font-size: 28px;
            font-weight: 600;
            margin: 5px auto;
            text-shadow: 0 1px 1px rgba(255,255,255,0.7);
            border: 1px solid rgba(255,255,255,0.3);
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 0; /* –£–±–∏—Ä–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É */
            padding: 5px 0; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
        }

        #tag-cloud {
            width: 80vmin;
            height: 80vmin;
            max-width: 700px;
            max-height: 700px;
            position: relative;
        }

        .tagcloud--item {
            /* –°—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç) */
            color: inherit;             /* –¶–≤–µ—Ç –∫–∞–∫ —É —Ä–æ–¥–∏—Ç–µ–ª—è */
            text-decoration: none;      /* –ë–µ–∑ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è */
            padding: 2px 5px;           /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
            border-radius: 4px;         /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π) */
            transition: all 0.3s ease;  /* –ü–ª–∞–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è */
            background: transparent;    /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
            box-shadow: none;           /* –ë–µ–∑ —Ç–µ–Ω–µ–π */
            border: none;               /* –ë–µ–∑ —Ä–∞–º–æ–∫ */
            cursor: pointer;            /* –ö—É—Ä—Å–æ—Ä-—É–∫–∞–∑–∞—Ç–µ–ª—å */
            white-space: nowrap;        /* –¢–µ–∫—Å—Ç –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
        }

        .tagcloud--item:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10;
        }

        footer {
            text-align: center;
            padding: 10px 0; /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã —Ñ—É—Ç–µ—Ä–∞ */
            color: #5f6368;
            font-size: 14px;
            margin-top: auto;
        }

        .click-count {
            display: none;  
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Mezzo</h1>
    </header>
    
    <div class="content">
        <div id="tag-cloud"></div>
    </div>
    
    <footer>
        &copy; 2025 Terre & Co.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/TagCloud@2.2.0/dist/TagCloud.min.js"></script>
    <script>
        // –î–∞–Ω–Ω—ã–µ —Ç–µ–≥–æ–≤ –∏–∑ Flask
        // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –Ω–∞—á–∞–ª–µ <script> –±–ª–æ–∫–∞
        const MIN_FONT_SIZE = 16;  // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (–ø–∏–∫—Å–µ–ª–∏)
        const MAX_FONT_SIZE = 36;  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (–ø–∏–∫—Å–µ–ª–∏)        
        const tags = JSON.parse('{{ tags | tojson | safe }}');
                
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–ª–∏–∫–æ–≤
        function getColorByClicks(clicks) {
           const clicksArray = tags.map(t => t.clicks);
    const minClicks = Math.min(...clicksArray);
    const maxClicks = Math.max(...clicksArray);

    // –ï—Å–ª–∏ –≤—Å–µ –∫–ª–∏–∫–∏ —Ä–∞–≤–Ω—ã –∏–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç
    if (minClicks === maxClicks) return 'rgb(150, 150, 150)'; // –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä—ã–π

    // –ù–æ—Ä–º–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –æ—Ç 0 –¥–æ 1
    const ratio = (clicks - minClicks) / (maxClicks - minClicks);

    // –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º ratio, —á—Ç–æ–±—ã –±–æ–ª—å—à–µ –∫–ª–∏–∫–æ–≤ = —Ç–µ–º–Ω–µ–µ —Ü–≤–µ—Ç
    const lightness = 50 * (1 - ratio); // 90% (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π) ‚Üí 0% (—á–µ—Ä–Ω—ã–π)

    return `hsl(0, 0%, ${lightness}%)`;   
        }       
 
        // –°–æ–∑–¥–∞–µ–º –æ–±–ª–∞–∫–æ —Ç–µ–≥–æ–≤
        const cloud = TagCloud('#tag-cloud', tags.map(tag => tag.name), {
            radius: Math.min(window.innerWidth, window.innerHeight) * 0.35,
            maxSpeed: 'normal',
            initSpeed: 'normal',
            direction: 135,
            keep: true,
            useHTML: true,
            itemClass: 'tagcloud--item'
        });
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±–ª–∞–∫–∞
 
        setTimeout(() => {
    const elements = document.querySelectorAll('.tagcloud--item');
    const clicksArray = tags.map(t => t.clicks);
    const minClicks = Math.min(...clicksArray);
    const maxClicks = Math.max(...clicksArray);
    
    elements.forEach((element, index) => {
        const tag = tags[index];
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —á–µ—Ä–µ–∑ —Ü–≤–µ—Ç–æ–≤–æ–π –∫—Ä—É–≥
        element.style.color = getColorByClicks(tag.clicks);
        
        // –ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (–∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ä–µ—à–µ–Ω–∏–∏)
        const fontSize = minClicks === maxClicks 
            ? (MIN_FONT_SIZE + MAX_FONT_SIZE) / 2
            : MIN_FONT_SIZE + (tag.clicks - minClicks) / (maxClicks - minClicks) * 
              (MAX_FONT_SIZE - MIN_FONT_SIZE);
        element.style.fontSize = `${fontSize}px`;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        element.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch(`/click/${tag.name}`);
                if (response.ok) {
                    tag.clicks++;
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
                    element.style.color = getColorByClicks(tag.clicks);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
                    const newFontSize = minClicks === maxClicks
                        ? (MIN_FONT_SIZE + MAX_FONT_SIZE) / 2
                        : MIN_FONT_SIZE + (tag.clicks - minClicks) / (maxClicks - minClicks) * 
                          (MAX_FONT_SIZE - MIN_FONT_SIZE);
                    element.style.fontSize = `${newFontSize}px`;
                    window.open(tag.url, '_blank');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        });
    });
}, 100);

    </script>
</body>
</html>
